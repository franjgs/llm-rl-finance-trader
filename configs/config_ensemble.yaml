# configs/config_ensemble.yaml
# Configuration file exclusively for the statistical + ML ensemble (non-RL)
# Fully compatible with your existing structure and development workflow (Spyder)
# Updated: November 15, 2025

# ===================================================================
# GENERAL SETTINGS
# ===================================================================
verbose: 1                              # 0 = silent, 1 = normal, 2 = debug (shows INFO + DEBUG logs)
stock_symbol: "NVDA"                    # Current king of sentiment-driven moves
# stock_symbol: "TSLA"
# stock_symbol: "AAPL"
# stock_symbol: "META"

data_interval: "1h"                     # "1d", "1h", "30m", "15m", "5m", "1m"
start_date: "2023-12-01"
end_date: "2025-11-15"

initial_balance: 1000000                # Starting capital for backtest
commission_bps: 1.5                     # Realistic intraday commission (1.5 bps)
slippage_bps: 2.0                       # Conservative slippage

# ===================================================================
# PATHS (same structure as your RL config)
# ===================================================================
paths:
  raw_dir: "data/raw"
  processed_dir: "data/processed"
  cache_dir: "data/cache"
  models_dir: "models"
  results_dir: "results"

# ===================================================================
# DATA & SENTIMENT
# ===================================================================
sentiment:
  enabled: true
  mode: "combined"                      # "combined" or "individual"
  sources:
    - finnhub
    - alphavantage
    - newsapi
    - yahoo
    - googlenews
    - gdelt
  model: "ProsusAI/finbert"
  force_refresh: false

# ===================================================================
# ENSEMBLE MODELS (6 proven components)
# ===================================================================
ensemble:
  momentum:
    enabled: true
    lookback_bars: 20  # Moskowitz et al. (2012) optimal window
    vol_lookback_bars: 20
    use_log_returns: true
    target_vol: 0.02
    max_exposure: 1.0
    smoothing_alpha: 0.12
    min_abs_mom: 0.0
    fillna_method: ffill
    return_raw: true

  volatility_targeting:
    enabled: true
    target_vol: 0.20                    # 20% annualized (standard in intraday quant)
    max_leverage: 3.0
    vol_lookback_bars: 20
    min_vol: 1e-4
    max_scale: 4.0
    return_raw: true

  xgboost:
      enabled: false
      model_path: "models/xgb_ensemble.joblib"
      retrain: false
    
      # Target horizon
      prediction_horizon_hours: 8       # lookahead
    
      # Feature engineering
      n_lags: 5                         # how many lagged features to include
      use_rolling_features: true        # SMA, EMA, RSI, volatility, etc.
      dropna: true
    
      # Time-series CV
      cv_splits: 3
      test_size_ratio: 0.2              # last 20% of data for validation
    
      # XGBoost parameters (essential)
      params:
        n_estimators: 300
        max_depth: 4
        learning_rate: 0.05
        subsample: 0.8
        colsample_bytree: 0.8
        min_child_weight: 3
        objective: "binary:logistic"
        eval_metric: "logloss"
        reg_lambda: 1.0
        reg_alpha: 0.0
    
      # Early stopping
      early_stopping_rounds: 30
      eval_set_fraction: 0.1             # last 10% of training used for validation
    
      # Output signal options
      threshold: 0.5                     # classification threshold
      output_type: "class"               # "class" or "proba"

  lstm:
      enabled: false
      model_path: "models/lstm_ensemble.pth"
      retrain: false
    
      # Sequence length (in bars, not days)
      sequence_length: 60
    
      # Model architecture
      input_size: 16       # auto-inferred if you want
      hidden_size: 64
      num_layers: 2
      dropout: 0.2
    
      # Training settings
      epochs: 20
      batch_size: 32
      learning_rate: 0.001
    
      # Target horizon
      prediction_horizon_hours: 8
    
      # Normalization
      normalize: true
    
      # Output
      output_type: "class"     # "class" or "proba"
      threshold: 0.5

  sentiment_signal:
      enabled: true
    
      # Thresholds for classification
      pos_threshold: 0.35
      neg_threshold: -0.25
    
      # Averaging and smoothing
      smoothing_window: 3
    
      # Output mode
      output_type: "class"     # "class" or "raw"
    
      # Scaling options (useful if sentiment = [-1,1] or [0,1])
      scale_min: -1.0
      scale_max: 1.0
      normalize: false

  rl_risk_overlay:
      enabled: true
    
      # Drawdown thresholds
      drawdown_reduce_level: -0.08   # reduce exposure
      drawdown_flat_level: -0.15     # exposure = 0
    
      # Sharpe-based boost
      sharpe_boost_threshold: 1.2
      sharpe_lookback_days: 60
    
      # Limits
      max_boost: 1.3
      reduce_factor: 0.5
    
      # Debugging
      store_multiplier: true

  weighting:
    equal_risk: true                    # All signals contribute equally to risk
    min_position_threshold: 0.05        # Below 5% â†’ flat (reduces noise)

# ===================================================================
# LOGGING & DEBUG
# ===================================================================
logging:
  level: "INFO"                         # Will be overridden by verbose flag
  show_progress_bars: true
  debug_features: false